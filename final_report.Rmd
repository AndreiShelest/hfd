---
title: "Quantitative strategies on High Frequency Data"
author: "Team members: Andrei Shelest and Niyetali Kaliyev"
date: "academic year 2024/2025"
output:
  pdf_document: default
  word_document:
    df_print: kable
  html_document:
    df_print: paged
subtitle: "presentation (in-sample quarters)"
fontsize: 14pt
---

<!-- 
CAUTION !!!

To get nicely looking tables in the output it is
required to install the kableExtra package in R console

install.packages("kableExtra")

-->
```{r,include=FALSE, echo = F}
options(repos = c(CRAN = "https://cran.r-project.org"))
install.packages("knitr")
library(knitr)

install.packages("kableExtra")
library(kableExtra)

```

# Approaches undertaken
For the first group of assets, we considered the implementation and evaluation of Moving Averages (MA) and Volatility Breakout models across distinct the given indices, namely Nasdaq and SP500. Each strategy was tailored to extract meaningful signals based on the unique characteristics of the asset classes. The common assumptions were:

- do not use in calculations the data from the first and last 10 minutes of the session (9:31-9:40 and 15:51-16:00) â€“ put missing values there,
- do not hold positions overnight (exit all positions 20 minutes before the session end, i.e. at 15:40),
- do not trade within the first 25 minutes of stocks quotations (9:31-9:55), but DO use the data for 9:41-9:55 in calculations of signal, volatility, etc.

Regarding the specifics of our projects, we considered combinations of strategies (momentum, mean-reverting) for 2 assets, and for each combination the quarters were testes separately (for each quarter, iterate through the space of strategy parameters). For MA model, we considered SMA (roll_mean and roll_median were tested separately) and EMA, while for Volatility break-out model, we used rolling standard deviation as our indicator. In addition, various lengths of memories for both, MAs and Volatility measures were taken into account. As an instance, for the crossover of MAs: fastEMA looped through 10, 15, 20, 30, 45, 60, 75 minutes, while slow EMA tried 60, 90, 120, 150, 180, 210 minutes. The same method was used for the single Volatility Break-out model, i.e. signalEMA in 10, 15, 20, 30, 45 minutes; slowEMA in 60, 90, 120, 150, 180 minutes; volat.sd in 60, 90, 120 minutes; and a multiplier among 1, 1.5, 2, 2.5, 3. It is worth mentioning that a  systematic grid search combined with sensitivity analysis was conducted. Obviously, we also made sure that we do not trade during the weekends. 



Finally, we the evaluated our strategies based on gross/net SR, CR and PnLs. We selected such a set of parameters that had the highest sum of cumNetPnL across all quarters. Consequently, these parameters assembled our best strategy.

For this group of assets, the best parameters for 2EMA-crossover were for the case when all strategies are Momentum. The same was observed for Volatility breakout strategy.

-Note: Volatility-breakout strategy uses signal EMA to check for the breaches of the bands, defined by slow EMA and running volatility (standard deviation), multiplied by some number. So, each set consists of four parameters.


```{r, echo = F, warning = F, message = F}
# here you can refer to the R codes that apply the strategy
# for asset group 1 to all quarters (in a loop)
source("apply_vol_strat.R")
```

### Parameters
```{r, echo = F}
g1_params_EMA <- read.csv("g1_params_EMA.csv")
g1_vol_params <- read.csv("g1_vol_params.csv")

kable(g1_params_EMA, 
          "markdown", 
          digits = 2,
          align = "r")

kable(g1_vol_params, 
          "markdown", 
          digits = 2,
          align = "r")
```

As we can see, the Volatility-breakout strategy slightly outperforms its peer. Thus, Volatility-Breakout is chosen as out best strategy.

# Group 1 -- summary of results (including out-of-sample)

## Finally selected strategy for group 1

Our winner strategy had the following parameters: 
- Momentum strategy
- Single Volatility Break-out technique
- Slow EMA 120
- Rolling standard dev. 90


<!-- here you can include code chunk that applies the strategy for group 1 and calculates all the summary statistics
-->


## Summary of results for group 1

```{r, echo = F}
quarter_stats.vol.all.group1 <-read.csv("quarter_stats.vol.all.group1.csv")
kable(quarter_stats.vol.all.group1[, -2], 
                    "markdown", 
                    digits = 2,
                    align = "r")

# more options here:
# https://haozhu233.github.io/kableExtra/awesome_table_in_html.html
```

The summary of results for Group 1 demonstrates that in general, the strategy managed to end the periods with positive PnLs, except for 2023_Q2 and 2024_Q2 while the average daily trades remained consistent.

## PnL of results for **group 1** -- quarter 2022Q1

```{r, echo = F, out.width ='100%'}
knitr::include_graphics("output_group1/pnl_group1_vol2022_Q1.png")

```

The strategy demonstrates consistent growth in both gross and net PnL over Q1 2022, with only a minor divergence between gross and net PnL due to transaction costs. The performance shows resilience during drawdown periods and strong upward trends, indicating effective parameterization and market adaptability.

## PnL of results for **group 1** -- quarter 2022Q2

your comments required !!!

## PnL of results for **group 1** -- quarter 2022Q3

```{r, echo = F, out.width ='100%'}
knitr::include_graphics("output_group1/pnl_group1_vol2022_Q3.png")

```

Some periods of stagnation and drawdowns can be observed, but it recovers effectively. The small gap between gross and net PnL indicates manageable transaction costs.

## PnL of results for **group 1** -- quarter 2022Q4

```{r, echo = F, out.width ='100%'}
knitr::include_graphics("output_group1/pnl_group1_vol2022_Q4.png")

```

A strong start in Q4 2022 but faced a significant drawdown mid-quarter, indicating vulnerability during certain market conditions. However, it recovered well, ending the quarter positively, though net PnL lagged slightly

## PnL of results for **group 1** -- quarter 2023Q1

your comments required !!!

## PnL of results for **group 1** -- quarter 2023Q2

```{r, echo = F, out.width ='100%'}
knitr::include_graphics("output_group1/pnl_group1_vol2023_Q2.png")

```

Q2 2023 shows a challenging period for the strategy, with a consistent downtrend in both gross and net PnL.

## PnL of results for **group 1** -- quarter 2023Q3


your comments required !!!

## PnL of results for **group 1** -- quarter 2023Q4

```{r, echo = F, out.width ='100%'}
knitr::include_graphics("output_group1/pnl_group1_vol2023_Q4.png")

```

Q4 2023 reflects a strong recovery after a challenging start, with a steady upward trend in both gross and net PnL during the latter half of the quarter.


## PnL of results for **group 1** -- quarter 2024Q1

```{r, echo = F, out.width ='100%'}
knitr::include_graphics("output_group1/pnl_group1_vol2024_Q1.png")

```

Q1 2024 exhibits volatile performance, with sharp swings in both gross and net PnL. Despite some strong gains, the strategy struggles to maintain consistent upward momentum, indicating sensitivity to market fluctuations. The divergence between gross and net PnL highlights the impact of transaction costs during periods of frequent trades.

## PnL of results for **group 1** -- quarter 2024Q2

```{r, echo = F, out.width ='100%'}
knitr::include_graphics("output_group1/pnl_group1_vol2024_Q2.png")

```

Q2 2024 shows a promising start with a significant peak early in the quarter, followed by periods of volatility and drawdowns. Again, the freuent trades mid-quarter influence our netPnL by the end of period.

## PnL of results for **group 1** -- quarter 2024Q3


your comments required !!!

## PnL of results for **group 1** -- quarter 2024Q4


your comments required !!!



# Group 2 -- summary of results (only in-sample)

<!-- here you can include code chunk that applies the strategy for group 2 and calculates all the summary statistics -->

```{r, echo = F, warning = F, message = F}
# here you can refer to the R codes that apply the strategy
# for asset group 2 to all quarters (in a loop)
source("apply_my_strategy_group2.R")
```

## Finally selected strategy for group 2

<!-- Provide **all the details** (approach and a set of **final parameters**) for assets from **group 2**. -->
<!-- (e.g. momentum strategy, cross over of two exponential moving averages EMA10 and EMA60 applied to EVERY single asset separately and then putting individual results into the portfolio). -->

### Approach to strategy search

The approach to finding parameters of entry is the following:

- First of all, consider combinations of strategies (momentum, mean-reverting), overall 16 combinations for four instruments.

- For each combination (for example, all mean-reverting strategies), analyze each quarter separately.

- In each quarter, iterate through the space of strategy parameters.

  - For a given set of parameters, create a strategy with entry separately for each instrument.

  - Aggregate daily results for strategies in one portfolio (sum up gross/net pnl and number of transactions). For example, add daily gross pnl values of EMA(10, 60) for AUD, CAD, XAU, XAG. 

  - Calculate statistics for this combination and remember it, combining all statistics for each set parameters and each quarter in one data frame.

- Select such a set of parameters that the sum of cumNetPnL across all quarters is the largest. Output this set as "the best strategy".

Firstly, we searched for best parameters for 2EMA-crossover, and the best parameters were for the case when all strategies are mean-reverting.

Then, we decided to test volatility-breakout strategies, but only when all strategies are mean-reverting, to save time and based on 2EMA-crossover prediction.

Volatility-breakout strategy uses signal EMA to check for the breaches of the bands, defined by slow EMA and running volatility (standard deviation), multiplied by some number. So, each set consists of four parameters.

### Strategy parameters

```{r, echo = F}
best_ema_params <- read.csv("output_group2/best_ema_params.csv")
best_vb_params <- read.csv("output_group2/best_vb_params.csv")

kable(best_ema_params, 
          "markdown", 
          digits = 2,
          align = "r")

kable(best_vb_params, 
          "markdown", 
          digits = 2,
          align = "r")
```

Volatility-breakout strategy is chosen as the best.


## Summary of results for group 2

```{r, echo = F}
quarter_stats.all.group2 <- read.csv("output_group2/quarter_stats.all.group2.csv")
kable(quarter_stats.all.group2[, -2], 
                    "markdown", 
                    digits = 2,
                    align = "r")

# more options here:
# https://haozhu233.github.io/kableExtra/awesome_table_in_html.html
```

Overall, the strategy managed to achieve positive net PnL in every quarter without trading too much, which we consider to be a good result.

## PnL of results for **group 2** -- quarter 2022Q1

```{r, echo = F, out.width ='100%'}
knitr::include_graphics("output_group2/pnl_group2_2022_Q1.png")

```

Strategy gained traction at the end of the quarter. Rather high volatility.

<!-- ## PnL of results for **group 2** -- quarter 2022Q2 -->

<!-- your comments required !!! -->

## PnL of results for **group 2** -- quarter 2022Q3

```{r, echo = F, out.width ='100%'}
knitr::include_graphics("output_group2/pnl_group2_2022_Q3.png")

```

PnL is mostly increasing. Volatility even higher.

## PnL of results for **group 2** -- quarter 2022Q4

```{r, echo = F, out.width ='100%'}
knitr::include_graphics("output_group2/pnl_group2_2022_Q4.png")

```

Only last month brought increase in PnL. Volatility is somewhat smaller.

## PnL of results for **group 2** -- quarter 2023Q1

your comments required !!!

## PnL of results for **group 2** -- quarter 2023Q2

```{r, echo = F, out.width ='100%'}
knitr::include_graphics("output_group2/pnl_group2_2023_Q2.png")

```

PnL mostly increased, but with a setback in the middle of the quarter. High volatility.

<!-- ## PnL of results for **group 2** -- quarter 2023Q3 -->


<!-- your comments required !!! -->

## PnL of results for **group 2** -- quarter 2023Q4

```{r, echo = F, out.width ='100%'}
knitr::include_graphics("output_group2/pnl_group2_2023_Q4.png")

```

Mostly flat and high volatile PnL, with gains at the end of the quarter only.


## PnL of results for **group 2** -- quarter 2024Q1

```{r, echo = F, out.width ='100%'}
knitr::include_graphics("output_group2/pnl_group2_2024_Q1.png")

```

Volatility is less pronounced, but a huge drawdown in march is present.

## PnL of results for **group 2** -- quarter 2024Q2

```{r, echo = F, out.width ='100%'}
knitr::include_graphics("output_group2/pnl_group2_2024_Q2.png")

```

Again, volatility is less pronounced, and again a drawdown, now in the middle of the quarter.

<!-- ## PnL of results for **group 2** -- quarter 2024Q3 -->


<!-- your comments required !!! -->

<!-- ## PnL of results for **group 2** -- quarter 2024Q4 -->


<!-- your comments required !!! -->

# Summary and conclusions

<!-- Here you should include a summary of obtained results and some conclusions. -->
The Volatility Breakout Momentum Strategy for group1 demonstrated robust performance across multiple quarters, leveraging breakout signals derived from volatility measures combined with moving averages. The strategy proved particularly effective during trending market conditions, showing consistent growth in gross and net PnL. Overall, this momentum-based approach provided a reliable framework for capturing breakout opportunities, delivering solid returns over the analyzed period while highlighting areas for further refinement.


For group 2, the volatility-breakout strategy showed decent results on in-sample data. The main features are: rather high values of signal EMA and slow EMA; rather high volatility; large drawdowns are possible.